{"ast":null,"code":"import _asyncToGenerator from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _objectSpread from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useEffect,useState}from'react';import{CardElement,useStripe,useElements}from'@stripe/react-stripe-js';import{useDispatch,useSelector}from'react-redux';import{createPaymentIntent}from'../functions/stripe';import{Link}from'react-router-dom';import{createOrder,emptyCart}from'../functions/user';import{Card}from'antd';import{DollarOutlined,CheckOutlined}from'@ant-design/icons';import Laptop from'../images/laptop.png';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var StripeCheckout=function StripeCheckout(){var dispatch=useDispatch();var _useSelector=useSelector(function(state){return _objectSpread({},state);}),user=_useSelector.user;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),succeeded=_useState2[0],setSucceeded=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),processing=_useState6[0],setProcessing=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),cartTotal=_useState12[0],setCartTotal=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),payable=_useState14[0],setPayable=_useState14[1];var stripe=useStripe();var elements=useElements();useEffect(function(){createPaymentIntent(user.token).then(function(res){console.log('hey');console.log('create payment intent',res);setClientSecret(res.data.clientSecret);setCartTotal(res.data.cartTotal);setPayable(res.data.cartTotal);});},[]);var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var payload;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();setProcessing(true);_context.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement),billing_details:{name:e.target.name.value}}});case 4:payload=_context.sent;if(payload.error){setError(\"Payment failed \".concat(payload.error.message));setProcessing(false);}else{createOrder(payload,user.token).then(function(res){if(res.data.ok){if(typeof window!=='undefined')localStorage.removeItem('cart');dispatch({type:'ADD_TO_CART',payload:[]});emptyCart(user.token);}});console.log(JSON.stringify(payload,null,4));setError(null);setProcessing(false);setSucceeded(true);}//\ncase 6:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();var handleChange=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setDisabled(e.empty);setError(e.error?e.error.message:\"\");//\ncase 2:case\"end\":return _context2.stop();}}},_callee2);}));return function handleChange(_x2){return _ref2.apply(this,arguments);};}();var cartStyle={style:{base:{color:\"#32325d\",fontFamily:\"Arial, sans-serif\",fontSmoothing:\"antialiased\",fontSize:\"16px\",\"::placeholder\":{color:\"#32325d\"}},invalid:{color:\"#fa755a\",iconColor:\"#fa755a\"}}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-center pb-5\",children:/*#__PURE__*/_jsx(Card,{cover:/*#__PURE__*/_jsx(\"img\",{src:Laptop,style:{height:'200px',objectFit:'contain',marginBottom:'-50px'}}),actions:[/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(DollarOutlined,{className:\"text-info\"}),\" \",/*#__PURE__*/_jsx(\"br\",{}),\"Cart Total: Rs.\",cartTotal]}),/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CheckOutlined,{className:\"text-info\"}),\" \",/*#__PURE__*/_jsx(\"br\",{}),\" Total Payable : Rs.\",payable]})]})}),/*#__PURE__*/_jsxs(\"form\",{id:\"payment-form\",className:\"stripe-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{id:\"card-element\",options:cartStyle,onChange:handleChange}),/*#__PURE__*/_jsx(\"button\",{className:\"stripe-button\",disabled:processing||succeeded||disabled,children:/*#__PURE__*/_jsx(\"span\",{id:\"button-text\",children:processing?/*#__PURE__*/_jsx(\"div\",{className:\"spinner\",id:\"spinner\"}):\"Pay\"})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"card-error\",role:\"alert\",children:error})]})]});};export default StripeCheckout;","map":{"version":3,"sources":["C:/Users/asus/ecommerce project/ecommerce/ecommerce-app/server/Client/src/components/StripeCheckout.js"],"names":["React","useEffect","useState","CardElement","useStripe","useElements","useDispatch","useSelector","createPaymentIntent","Link","createOrder","emptyCart","Card","DollarOutlined","CheckOutlined","Laptop","StripeCheckout","dispatch","state","user","succeeded","setSucceeded","error","setError","processing","setProcessing","disabled","setDisabled","clientSecret","setClientSecret","cartTotal","setCartTotal","payable","setPayable","stripe","elements","token","then","res","console","log","data","handleSubmit","e","preventDefault","confirmCardPayment","payment_method","card","getElement","billing_details","name","target","value","payload","message","ok","window","localStorage","removeItem","type","JSON","stringify","handleChange","empty","cartStyle","style","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor","height","objectFit","marginBottom"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport { CardElement,useStripe,useElements } from '@stripe/react-stripe-js'\r\nimport { useDispatch,useSelector } from 'react-redux'\r\nimport { createPaymentIntent } from '../functions/stripe'\r\nimport { Link } from 'react-router-dom'\r\nimport { createOrder, emptyCart } from '../functions/user'\r\nimport {Card} from 'antd'\r\nimport {DollarOutlined,CheckOutlined} from '@ant-design/icons'\r\nimport Laptop from '../images/laptop.png'\r\n\r\nconst StripeCheckout = () => {\r\n const dispatch=useDispatch();\r\n const {user}=useSelector((state)=>({...state}))\r\n\r\n const[succeeded,setSucceeded]=useState(false)\r\n const[error,setError]=useState(null)\r\n const[processing,setProcessing]=useState(false)\r\n const[disabled,setDisabled]=useState(true)\r\n const[clientSecret,setClientSecret]=useState(\"\")\r\nconst [cartTotal,setCartTotal]=useState(0);\r\nconst [payable,setPayable]=useState(0)\r\n\r\n    const stripe=useStripe();\r\n    const elements=useElements();\r\n\r\n    useEffect(()=>{\r\n        createPaymentIntent(user.token)\r\n        .then(res=>{\r\n            console.log('hey')\r\n            console.log('create payment intent',res)\r\n            setClientSecret(res.data.clientSecret)\r\n            setCartTotal(res.data.cartTotal)\r\n            setPayable(res.data.cartTotal)\r\n        })\r\n    },[])\r\n\r\n    const handleSubmit=async(e)=>{\r\n      e.preventDefault()\r\n      setProcessing(true)\r\n      const payload=await stripe.confirmCardPayment(clientSecret,{\r\n        payment_method:{\r\n          card:elements.getElement(CardElement),\r\n          billing_details:{\r\n            name: e.target.name.value\r\n          },\r\n        },\r\n\r\n      })\r\n\r\n      if(payload.error){\r\n        setError(`Payment failed ${payload.error.message}`)\r\n        setProcessing(false)\r\n      }\r\n      else{\r\n\r\n         createOrder(payload,user.token)\r\n        .then((res)=>{\r\n          if(res.data.ok){\r\n            if(typeof window!=='undefined' ) localStorage.removeItem('cart');\r\n\r\n            dispatch({\r\n              type:'ADD_TO_CART',\r\n              payload:[]\r\n            });\r\n\r\n            emptyCart(user.token);\r\n          }\r\n        })\r\n         \r\n\r\n\r\n        console.log(JSON.stringify(payload,null,4));\r\n        setError(null);\r\n        setProcessing(false)\r\n        setSucceeded(true)\r\n      }\r\n        //\r\n    }\r\n    const handleChange=async(e)=>{\r\n\r\n      setDisabled(e.empty)\r\n      setError(e.error?e.error.message:\"\")\r\n        //\r\n    }\r\n    const cartStyle = {\r\n        style: {\r\n          base: {\r\n            color: \"#32325d\",\r\n            fontFamily: \"Arial, sans-serif\",\r\n            fontSmoothing: \"antialiased\",\r\n            fontSize: \"16px\",\r\n            \"::placeholder\": {\r\n              color: \"#32325d\",\r\n            },\r\n          },\r\n          invalid: {\r\n            color: \"#fa755a\",\r\n            iconColor: \"#fa755a\",\r\n          },\r\n        },\r\n      };\r\n\r\n    return (\r\n        <>\r\n       \r\n        <div className='text-center pb-5'>\r\n        <Card\r\n          cover={\r\n            <img\r\n             src={Laptop}\r\n             style={{\r\n              height:'200px',\r\n              objectFit:'contain',\r\n              marginBottom:'-50px',\r\n             }}\r\n            />\r\n          }\r\n          actions={[\r\n            <>\r\n              <DollarOutlined className='text-info'  /> <br/>Cart Total: Rs.{cartTotal}\r\n            </>,\r\n            <>\r\n              <CheckOutlined className='text-info'/> <br/> Total Payable : Rs.{payable}\r\n            </>\r\n          ]}\r\n        />\r\n\r\n        </div>\r\n\r\n       \r\n         <form id='payment-form' className='stripe-form' onSubmit={handleSubmit}>\r\n             <CardElement \r\n             id='card-element'\r\n             options={cartStyle}\r\n             onChange={handleChange}\r\n             />\r\n          <button className='stripe-button' disabled={processing || succeeded || disabled}>\r\n\r\n              <span id='button-text'>\r\n                  {processing?<div className='spinner' id='spinner'></div>:\"Pay\"}\r\n              </span>\r\n          </button>\r\n        {error && (\r\n          <div className='card-error' role='alert'>\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n         </form>\r\n         {/* <p className={succeeded?\"result-message\": \"result-message hidden\"}>\r\n          Payment Successful.{\" \"}\r\n          <Link to='/user/history'> See it on your purchase history</Link>\r\n          </p> */}\r\n        </>\r\n    )\r\n\r\n}\r\n\r\nexport default StripeCheckout"]},"metadata":{},"sourceType":"module"}