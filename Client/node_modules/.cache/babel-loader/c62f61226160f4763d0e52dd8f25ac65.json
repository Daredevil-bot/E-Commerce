{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _asyncToGenerator from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _objectSpread from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect}from'react';import{auth}from\"../../firebase\";import{toast}from\"react-toastify\";import{useDispatch,useSelector}from'react-redux';import\"react-toastify/dist/ReactToastify.css\";import{useNavigate}from\"react-router-dom\";import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var CompleteRegister=function CompleteRegister(){var _useSelector=useSelector(function(state){return _objectSpread({},state);}),user=_useSelector.user;useEffect(function(){if(user&&user.token)navigate('/');},[user]);var dispatch=useDispatch();var createUpdate=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(authtoken){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.post(\"http://localhost:8000/api/create-and-update-user\",{},{//axios is sending request to middleware having url as first argument   \nheaders:{authtoken:authtoken}});case 2:return _context.abrupt(\"return\",_context.sent);case 3:case\"end\":return _context.stop();}}},_callee);}));return function createUpdate(_x){return _ref.apply(this,arguments);};}();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setemail=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),pass=_useState4[0],setpass=_useState4[1];useEffect(function(){setemail(window.localStorage.getItem(\"emailRegistration\"));},[]);var navigate=useNavigate();var handleClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var result,_user,idToken;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;e.preventDefault();_context2.next=4;return auth.signInWithEmailLink(email,window.location.href);case 4:result=_context2.sent;if(!result.user.emailVerified){_context2.next=13;break;}//REMOVE EMAIL FROM LOCAL STORAGE\nwindow.localStorage.removeItem('emailRegistration');//GET USER TOKEN ID FOR USING IN REDUX STORE FOR FUTURE USE and also update password for future verification\n_user=auth.currentUser;_context2.next=10;return _user.updatePassword(pass);case 10:idToken=_user.getIdTokenResult();createUpdate(idToken.token).then(function(res){return dispatch({type:\"LOGGED_IN_USER\",payload:{//res here deines response from backend as axios made a post request\nname:res.data.name,email:res.data.email,token:idToken.token,role:res.data.role,_id:res.data._id}});});navigate('/');case 13:_context2.next=18;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 18:case\"end\":return _context2.stop();}}},_callee2,null,[[0,15]]);}));return function handleClick(_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"container p-5 \",style:{margin:\"0px 400px 100px\"},children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Complete Registration\"}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-mid-3 offset col-mid-6\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleClick,children:[/*#__PURE__*/_jsx(\"input\",{type:\"email\",className:\"form-control\",style:{width:\"600px\",margin:\"10px 0px 0px 0px\"},value:email,disabled:true}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"form-control\",style:{width:\"600px\",margin:\"10px 0px 0px 0px\"},value:pass,onChange:function onChange(e){setpass(e.target.value);},autoFocus:true}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",value:\"submit\",className:\"btn btn-raised\",style:{margin:\"20px 0px 0px 0px\"},children:\"Sign in\"})]})})})]})});};export default CompleteRegister;","map":{"version":3,"sources":["C:/Users/asus/ecommerce project/ecommerce/ecommerce-app/server/client/src/pages/auth/CompleteRegister.js"],"names":["React","useState","useEffect","auth","toast","useDispatch","useSelector","useNavigate","axios","CompleteRegister","state","user","token","navigate","dispatch","createUpdate","authtoken","post","headers","email","setemail","pass","setpass","window","localStorage","getItem","handleClick","e","preventDefault","signInWithEmailLink","location","href","result","emailVerified","removeItem","currentUser","updatePassword","idToken","getIdTokenResult","then","res","type","payload","name","data","role","_id","console","log","margin","width","target","value"],"mappings":"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","sourcesContent":["import React,{useState,useEffect} from 'react'\r\nimport  {auth} from \"../../firebase\"\r\nimport {toast} from \"react-toastify\"\r\nimport { useDispatch,useSelector } from 'react-redux'\r\nimport \"react-toastify/dist/ReactToastify.css\"\r\nimport {useNavigate} from \"react-router-dom\"\r\n\r\nimport axios from \"axios\"\r\nconst CompleteRegister = () => {\r\n    \r\n    const {user} = useSelector((state)=>({...state}))\r\nuseEffect(()=>{\r\n    if(user && user.token ) navigate('/')\r\n},[user])\r\nlet dispatch=useDispatch()\r\n\r\nconst createUpdate=async (authtoken)=>{\r\n    return await axios.post(\"http://localhost:8000/api/create-and-update-user\",{},{              //axios is sending request to middleware having url as first argument   \r\n        headers:{\r\n            authtoken\r\n        }\r\n    } )\r\n}    \r\n\r\n\r\n\r\n\r\nconst[email,setemail]=useState('');\r\nconst[pass,setpass]=useState('')\r\nuseEffect(()=>{\r\nsetemail(window.localStorage.getItem(\"emailRegistration\"))\r\n},[])\r\nconst navigate =useNavigate();\r\nconst handleClick=async (e)=>{\r\n    try{\r\n    e.preventDefault();\r\n   const result=await auth.signInWithEmailLink(email,window.location.href)\r\n   if(result.user.emailVerified){\r\n       //REMOVE EMAIL FROM LOCAL STORAGE\r\n       window.localStorage.removeItem('emailRegistration')\r\n       //GET USER TOKEN ID FOR USING IN REDUX STORE FOR FUTURE USE and also update password for future verification\r\n       let user=auth.currentUser;\r\n       await user.updatePassword(pass)\r\n       const idToken =user.getIdTokenResult();\r\n       createUpdate(idToken.token)\r\n       \r\n       .then(res=>\r\n        \r\n        dispatch({\r\n            type: \"LOGGED_IN_USER\",\r\n            payload :{                                //res here deines response from backend as axios made a post request\r\n                name:res.data.name,\r\n                email:res.data.email,\r\n                token:idToken.token,\r\n                role:res.data.role,\r\n                _id:res.data._id\r\n            }\r\n        })\r\n        \r\n       )\r\n       navigate('/')\r\n     }\r\n    }\r\n\r\n    catch(error){\r\n        console.log(error)\r\n    }\r\n   \r\n}\r\n\r\n    \r\n\r\n    \r\n    return (\r\n        <>\r\n       <div className=\"container p-5 \" style={{margin:\"0px 400px 100px\"}} >\r\n           <h4 >Complete Registration</h4>\r\n\r\n       <div className='row'>\r\n           <div className='col-mid-3 offset col-mid-6'>\r\n               \r\n      \r\n       <form onSubmit={handleClick} >\r\n            <input\r\n            type='email'\r\n            className='form-control'\r\n            style={{width:\"600px\",margin:\"10px 0px 0px 0px\"}}\r\n            value={email}\r\n            disabled\r\n            ></input>\r\n            <input\r\n            type='password'\r\n            className='form-control'\r\n            style={{width:\"600px\",margin:\"10px 0px 0px 0px\"}}\r\n            value={pass}\r\n            onChange={e=>{setpass(e.target.value)}}\r\n            autoFocus\r\n            ></input>\r\n            <button type='submit' value='submit' className='btn btn-raised'style={{margin:\"20px 0px 0px 0px\"}}>Sign in</button>\r\n\r\n        </form>\r\n        </div>\r\n       </div>\r\n       \r\n       </div>\r\n\r\n        </>\r\n    )\r\n}\r\n\r\nexport default CompleteRegister;\r\n"]},"metadata":{},"sourceType":"module"}