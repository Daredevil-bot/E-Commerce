{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _asyncToGenerator from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _objectSpread from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\asus\\\\ecommerce project\\\\ecommerce\\\\ecommerce-app\\\\server\\\\Client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect}from'react';import{auth,googleAuthProvider}from\"../../firebase\";import{toast}from\"react-toastify\";import\"react-toastify/dist/ReactToastify.css\";import{Button}from'antd';import{MailOutlined,GoogleOutlined}from'@ant-design/icons';import{useDispatch,useSelector}from'react-redux';import{Link,useNavigate}from'react-router-dom';import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Register=function Register(){var navigate=useNavigate();var roleBasedRedirect=function roleBasedRedirect(res){var intended=navigate.location.state;if(intended){navigate(intended.from);}else{if(res.data.role===\"admin\"){navigate('/admin/dashboard');}else{navigate('/user/history');}}};var _useSelector=useSelector(function(state){return _objectSpread({},state);}),user=_useSelector.user;useEffect(function(){if(user&&user.token){navigate('/');}},[user,navigate]);var createUpdate=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(authtoken){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.post(\"http://localhost:8000/api/create-and-update-user\",{},{//axios is sending request to middleware having url as first argument   \nheaders:{authtoken:authtoken}});case 2:return _context.abrupt(\"return\",_context.sent);case 3:case\"end\":return _context.stop();}}},_callee);}));return function createUpdate(_x){return _ref.apply(this,arguments);};}();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setemail=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),pass=_useState4[0],setpass=_useState4[1];var dispatch=useDispatch();var googlelogin=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:auth.signInWithPopup(googleAuthProvider).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(result){var user,idToken;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:user=result.user;_context2.next=3;return user.getIdTokenResult();case 3:idToken=_context2.sent;createUpdate(idToken.token).then(function(res){dispatch({type:\"LOGGED_IN_USER\",payload:{//res here deines response from backend as axios made a post request\nname:res.data.name,email:res.data.email,token:idToken.token,role:res.data.role,_id:res.data._id}});navigate('/');roleBasedRedirect(res);});case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3){return _ref3.apply(this,arguments);};}()).catch(function(err){console.log(err);toast.error(err.message);});case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function googlelogin(_x2){return _ref2.apply(this,arguments);};}();var handleClick=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){var result,_user,idToken;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return auth.signInWithEmailAndPassword(email,pass);case 3:result=_context4.sent;_user=result.user;_context4.next=7;return _user.getIdTokenResult();case 7:idToken=_context4.sent;//sending token to middleware to validate\n//\ncreateUpdate(idToken.token).then(function(res){dispatch({type:\"LOGGED_IN_USER\",payload:{//res here deines response from backend as axios made a post request\nname:res.data.name,email:res.data.email,token:idToken.token,role:res.data.role,_id:res.data._id}});roleBasedRedirect(res);}).catch(function(err){return console.log(err);});_context4.next=15;break;case 11:_context4.prev=11;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);toast.error(_context4.t0.message);case 15:case\"end\":return _context4.stop();}}},_callee4,null,[[0,11]]);}));return function handleClick(_x4){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"container p-5 \",style:{margin:\"0px 400px 100px\"},children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Login\"}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-mid-3 offset col-mid-6\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleClick,children:[/*#__PURE__*/_jsx(\"input\",{type:\"email\",className:\"form-control\",style:{width:\"600px\",margin:\"20px 0px 0px 0px\"},value:email,onChange:function onChange(e){setemail(e.target.value);},placeholder:\"Your email\",autoFocus:true}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"form-control\",style:{width:\"600px\",margin:\"25px 0px 0px 0px\"},value:pass,onChange:function onChange(e){setpass(e.target.value);},placeholder:\"Your password\"}),/*#__PURE__*/_jsx(Button,{type:\"primary\",className:\"mb-3\",style:{width:\"600px\",margin:\"30px 0px 0px 0px\",display:\"block\"},shape:\"round\",size:\"large\",width:\"600px\",block:true,icon:/*#__PURE__*/_jsx(MailOutlined,{}),disabled:!email||!pass,onClick:handleClick,children:\"Log in with Email/Password\"}),/*#__PURE__*/_jsx(Button,{type:\"danger\",className:\"mb-3\",style:{width:\"600px\",margin:\"25px 0px 0px 0px\"},shape:\"round\",size:\"large\",width:\"600px\",block:true,icon:/*#__PURE__*/_jsx(GoogleOutlined,{}),onClick:googlelogin,children:\"Log in with Google\"}),/*#__PURE__*/_jsxs(Button,{type:\"link\",style:{display:\"block\",margin:\"0px 0px 0px 450px\"},children:[/*#__PURE__*/_jsx(Link,{to:\"/forgot/password\"}),\"Forgot password? \"]})]})})})]})});};export default Register;","map":{"version":3,"sources":["C:/Users/asus/ecommerce project/ecommerce/ecommerce-app/server/client/src/pages/auth/Login.js"],"names":["React","useState","useEffect","auth","googleAuthProvider","toast","Button","MailOutlined","GoogleOutlined","useDispatch","useSelector","Link","useNavigate","axios","Register","navigate","roleBasedRedirect","res","intended","location","state","from","data","role","user","token","createUpdate","authtoken","post","headers","email","setemail","pass","setpass","dispatch","googlelogin","e","signInWithPopup","then","result","getIdTokenResult","idToken","type","payload","name","_id","catch","err","console","log","error","message","handleClick","signInWithEmailAndPassword","margin","width","target","value","display"],"mappings":"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","sourcesContent":["import React,{useState,useEffect} from 'react'\r\nimport  {auth, googleAuthProvider} from \"../../firebase\"\r\nimport {toast} from \"react-toastify\"\r\nimport \"react-toastify/dist/ReactToastify.css\"\r\nimport { Button } from 'antd'\r\nimport { MailOutlined ,GoogleOutlined } from '@ant-design/icons';\r\nimport { useDispatch,useSelector } from 'react-redux'\r\nimport { Link, useNavigate } from 'react-router-dom'\r\nimport axios from \"axios\"\r\nconst Register = () => {\r\n    let navigate=useNavigate()\r\n    const roleBasedRedirect=(res)=>{\r\n        let intended=navigate.location.state\r\n        if(intended){\r\n            navigate(intended.from)\r\n        }\r\n        else{\r\n            if(res.data.role===\"admin\"){\r\n                navigate('/admin/dashboard')\r\n            }\r\n            else{\r\n                navigate('/user/history')\r\n            }\r\n        }\r\n       \r\n    }\r\nconst {user} = useSelector((state)=>({...state}))\r\nuseEffect(()=>{\r\n    if(user && user.token ){ navigate('/')}\r\n},[user,navigate])\r\n\r\nconst createUpdate=async (authtoken)=>{\r\n    return await axios.post(\"http://localhost:8000/api/create-and-update-user\",{},{              //axios is sending request to middleware having url as first argument   \r\n        headers:{\r\n            authtoken\r\n        }\r\n    } )\r\n}    \r\nconst[email,setemail]=useState('');\r\nconst [pass,setpass]=useState('')\r\nlet dispatch=useDispatch();\r\nconst googlelogin=async (e)=>{\r\n    auth.signInWithPopup(googleAuthProvider)\r\n    .then(async (result)=>{\r\n        const{user}=result\r\n        const idToken=await user.getIdTokenResult()\r\n        createUpdate(idToken.token)\r\n        .then((res)=>{\r\n        dispatch({\r\n            type: \"LOGGED_IN_USER\",\r\n            payload :{                                //res here deines response from backend as axios made a post request\r\n                name: res.data.name,\r\n                email:res.data.email,\r\n                token:idToken.token,\r\n                role:res.data.role,\r\n                _id:res.data._id\r\n            }\r\n        });\r\n        \r\n        \r\n        navigate('/')\r\n        roleBasedRedirect(res)\r\n    })\r\n        \r\n    })\r\n    .catch((err)=>{\r\n        console.log(err)\r\n        toast.error(err.message);\r\n\r\n    })\r\n\r\n}\r\nconst handleClick=async (e)=>{\r\n   \r\n try{\r\n    const result=await auth.signInWithEmailAndPassword(email,pass)\r\n    const{user} =result;\r\n    const idToken=await user.getIdTokenResult();\r\n   //sending token to middleware to validate\r\n   //\r\n\r\n\r\n   createUpdate(idToken.token)\r\n   .then((res)=>{\r\n    dispatch({\r\n        type: \"LOGGED_IN_USER\",\r\n        payload :{                                //res here deines response from backend as axios made a post request\r\n            name: res.data.name,\r\n            email:res.data.email,\r\n            token:idToken.token,\r\n            role:res.data.role,\r\n            _id:res.data._id\r\n        }\r\n    });\r\n    roleBasedRedirect(res)\r\n})\r\n  .catch(err=>console.log(err))\r\n }\r\n catch(error){\r\n     console.log(error)\r\n     toast.error(error.message)\r\n\r\n }\r\n}\r\n\r\n    \r\n\r\n    \r\n    return (\r\n        <>\r\n       <div className=\"container p-5 \" style={{margin:\"0px 400px 100px\"}} >\r\n           <h4 >Login</h4>\r\n\r\n       <div className='row'>\r\n           <div className='col-mid-3 offset col-mid-6'>\r\n               \r\n      \r\n       <form onSubmit={handleClick} >\r\n            <input\r\n            type='email'\r\n            className='form-control'\r\n            style={{width:\"600px\",margin:\"20px 0px 0px 0px\"}}\r\n            value={email}\r\n            onChange={e=>{setemail(e.target.value)}}    \r\n            placeholder='Your email'\r\n            autoFocus\r\n            ></input>\r\n             <input\r\n            type='password'\r\n            className='form-control'\r\n            style={{width:\"600px\",margin:\"25px 0px 0px 0px\"}}\r\n            value={pass}\r\n            onChange={e=>{setpass(e.target.value)}}\r\n            placeholder='Your password'\r\n            ></input>\r\n            <Button\r\n            type=\"primary\"\r\n            className='mb-3'\r\n            style={{width : \"600px\",margin : \"30px 0px 0px 0px\",display:\"block\"}}\r\n            shape='round'\r\n            size=\"large\"\r\n            width=\"600px\"\r\n            block\r\n            icon={<MailOutlined/>}\r\n            disabled={!email || !pass}\r\n            onClick={handleClick}\r\n\r\n            >\r\n                Log in with Email/Password\r\n            </Button>\r\n            <Button\r\n            type=\"danger\"\r\n            className='mb-3'\r\n            style={{width : \"600px\",margin : \"25px 0px 0px 0px\"}}\r\n            shape='round'\r\n            size=\"large\"\r\n            width=\"600px\"\r\n            block\r\n            icon={<GoogleOutlined/>}\r\n            \r\n            onClick={googlelogin}\r\n            >\r\n                Log in with Google\r\n            </Button >\r\n            <Button type=\"link\" style={{display:\"block\" ,margin:\"0px 0px 0px 450px\"}}  >\r\n                <Link to=\"/forgot/password\"></Link>Forgot password? </Button>\r\n\r\n        </form>\r\n        </div>\r\n       </div>\r\n       \r\n       </div>\r\n\r\n        </>\r\n    )\r\n\r\n}\r\nexport default Register\r\n"]},"metadata":{},"sourceType":"module"}